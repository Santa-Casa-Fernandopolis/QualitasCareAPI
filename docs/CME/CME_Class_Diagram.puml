@startuml
title QualitasCare – Domínio Compartilhado (core) x Módulo CME

' =========================
' CORE COMPARTILHADO
' =========================
package "com.qualitascare.core.domain" as CORE {

  class Tenant {
    +id: Long
    +code: String
    +name: String
    +active: boolean
  }

  class User {
    +id: Long
    +username: String
    +fullName: String
    +department: String
  }

  ' --- Estrutura hospitalar e abstrações reutilizáveis ---
  enum TipoSetor {
    CME
    CC
    UTI
    ENF
    FARM
    HOTEL
    LAB
    ENGC
  }
  class Setor {
    +id: Long
    +nome: String
    +tipo: TipoSetor
    +ativo: boolean
    +tenantId: Long
  }

  interface Rastreavel {
    +getCodigoRastreio(): String
  }
  interface Movimentavel {
    +getIdentificadorMov(): String
  }
  interface Inspecionavel {
    +getIdentificadorInspecao(): String
  }

  class Instrumento {
    +id: Long
    +codigo: String
    +nome: String
    +fabricante: String
    +critico: boolean
    +tenantId: Long
    +getIdentificadorInspecao()
  }
  Instrumento ..|> Inspecionavel

  ' Kit genérico reutilizável (curativo, parto, procedimento, etc.)
  class KitProcedimento {
    +id: Long
    +nome: String
    +descricao: String
    +tempoValidadeDias: Integer
    +ativo: boolean
    +tenantId: Long
    +getIdentificadorInspecao()
    +getCodigoRastreio()
    +getIdentificadorMov()
  }
  KitProcedimento ..|> Inspecionavel
  KitProcedimento ..|> Rastreavel
  KitProcedimento ..|> Movimentavel

  class KitItem {
    +id: Long
    +qtdPrevista: Integer
    +sentinela: boolean
  }
  KitProcedimento "1" -- "1..*" KitItem
  Instrumento "1" -- "0..*" KitItem

  ' Movimentação genérica entre setores/usuários
  enum StatusMov {
    CRIADA
    EM_TRANSITO
    ENTREGUE
    DEVOLVIDA
  }
  class Movimentacao {
    +id: Long
    +dataHora: Instant
    +status: StatusMov
    +observacao: String
    +setorOrigemId: Long
    +setorDestinoId: Long
    +executadoPorUserId: Long
    +tenantId: Long
  }

  ' Inspeção genérica de materiais
  class InspecaoMaterial {
    +id: Long
    +data: LocalDate
    +totalItens: Integer
    +conformes: Integer
    +naoConformes: Integer
    +observacao: String
    +tenantId: Long
  }

  ' Cultura (genérica: coleta, origem, resultado)
  class ExameCultura {
    +id: Long
    +amostra: String
    +origem: String
    +dataColeta: Instant
    +resultado: String
    +tenantId: Long
  }

  ' Ligações core
  Tenant "1" -- "0..*" Setor
  Tenant "1" -- "0..*" Instrumento
  Tenant "1" -- "0..*" KitProcedimento
  Tenant "1" -- "0..*" Movimentacao
  Tenant "1" -- "0..*" InspecaoMaterial
  Tenant "1" -- "0..*" ExameCultura

  Setor "1" -- "0..*" Movimentacao : origem/destino
  User "1" -- "0..*" Movimentacao : executadoPor
}

' =========================
' MÓDULO CME (específico)
' =========================
package "com.qualitascare.modules.cme.domain" as CME {

  ' Especialização do kit para esterilização
  class KitEsterilizavel {
  }
  KitEsterilizavel --|> CORE.KitProcedimento

  enum StatusLote {
    EM_PROCESSO
    LIBERADO
    VENCIDO
    BLOQUEADO
  }
  enum StatusCiclo {
    EM_ANDAMENTO
    CONCLUIDO
    ABORTADO
  }
  class LoteEtiqueta {
    +id: Long
    +kitId: Long
    +codigoQR: String
    +dataEmbalo: Instant
    +validade: Instant
    +montadoPorNome: String
    +montadoPorCoren: String
    +lote: String
    +conferenciaPerfuroOk: boolean
    +status: StatusLote
    +tenantId: Long
    +createdBy: Long
    +getCodigoRastreio()
    +getIdentificadorMov()
  }
  LoteEtiqueta ..|> CORE.Rastreavel
  LoteEtiqueta ..|> CORE.Movimentavel

  class Autoclave {
    +id: Long
    +codigo: String
    +modelo: String
    +localizacao: String
    +ativo: boolean
    +tenantId: Long
  }

  class CicloEsterilizacao {
    +id: Long
    +autoclaveId: Long
    +inicio: Instant
    +fim: Instant
    +parametros: String
    +status: StatusCiclo
    +operadorUserId: Long
    +tenantId: Long
  }
  note right of CicloEsterilizacao
    Parametros armazenam temperatura, pressão e tempo consolidados do ciclo.
  end note
  Autoclave "1" -- "0..*" CicloEsterilizacao
  CicloEsterilizacao "1" -- "0..*" LoteEtiqueta : lotesProcessados
  CORE.User "1" -- "0..*" CicloEsterilizacao : operador

  enum ResultadoTeste {
    OK
    FALHA
    INCONCLUSIVO
  }
  class TesteBowieDick {
    +id: Long
    +autoclaveId: Long
    +cicloId: Long
    +data: Instant
    +resultado: ResultadoTeste
    +observacao: String
    +evidenciaPath: String
    +tenantId: Long
  }
  Autoclave "1" -- "0..*" TesteBowieDick
  CicloEsterilizacao "0..1" -- "0..*" TesteBowieDick

  class IndicadorQuimico {
    +id: Long
    +cicloId: Long
    +loteInsumo: String
    +tipo: String
    +resultado: ResultadoTeste
    +observacao: String
    +tenantId: Long
  }
  class IndicadorBiologico {
    +id: Long
    +cicloId: Long
    +loteInsumo: String
    +incubacaoInicio: Instant
    +leitura: Instant
    +resultado: ResultadoTeste
    +observacao: String
    +tenantId: Long
  }
  CicloEsterilizacao "1" -- "0..*" IndicadorQuimico
  CicloEsterilizacao "1" -- "0..*" IndicadorBiologico

  class HigienizacaoUltrassonica {
    +id: Long
    +data: LocalDate
    +turno: String
    +responsavelUserId: Long
    +enfermeiraUserId: Long
    +tenantId: Long
  }
  class HigienizacaoAutoclaveProfunda {
    +id: Long
    +autoclaveId: Long
    +data: LocalDate
    +observacao: String
    +responsavelUserId: Long
    +enfermeiraUserId: Long
    +tenantId: Long
  }
  Autoclave "1" -- "0..*" HigienizacaoAutoclaveProfunda

  class SaneantePeraceticoLote {
    +id: Long
    +dataDiluicao: Instant
    +validade: Instant
    +responsavelUserId: Long
    +enfermeiraUserId: Long
    +concentracao: String
    +tenantId: Long
  }
  class UsoSaneante {
    +id: Long
    +lotePeraceticoId: Long
    +dataHora: Instant
    +quantidade: BigDecimal
    +finalidade: String
    +tenantId: Long
  }
  SaneantePeraceticoLote "1" -- "0..*" UsoSaneante

  class NaoConformidadeCME {
    +id: Long
    +loteEtiquetaId: Long
    +autoclaveId: Long
    +cicloId: Long
    +dataAbertura: Instant
    +tipo: String
    +descricao: String
    +acaoCorretiva: String
    +status: StatusNaoConformidade
    +tenantId: Long
  }
  note right of NaoConformidadeCME
    Tipo abrange ocorrências como BD, BI, CI, embalagem, sujidade e prazo expirado.
  end note

  enum StatusNaoConformidade {
    ABERTA
    EM_TRATAMENTO
    ENCERRADA
  }

  ' Ligações com o core
  CORE.Tenant "1" -- "0..*" KitEsterilizavel
  CORE.Tenant "1" -- "0..*" LoteEtiqueta
  CORE.Tenant "1" -- "0..*" Autoclave
  CORE.Tenant "1" -- "0..*" CicloEsterilizacao
  CORE.Tenant "1" -- "0..*" TesteBowieDick
  CORE.Tenant "1" -- "0..*" IndicadorQuimico
  CORE.Tenant "1" -- "0..*" IndicadorBiologico
  CORE.Tenant "1" -- "0..*" HigienizacaoUltrassonica
  CORE.Tenant "1" -- "0..*" HigienizacaoAutoclaveProfunda
  CORE.Tenant "1" -- "0..*" SaneantePeraceticoLote
  CORE.Tenant "1" -- "0..*" UsoSaneante
  CORE.Tenant "1" -- "0..*" NaoConformidadeCME

  ' Reuso das abstrações do core
  CME.LoteEtiqueta ..> CORE.Rastreavel
  CME.LoteEtiqueta ..> CORE.Movimentavel

  ' Exame de cultura e inspeções genéricas referenciam objetos rastreáveis/inspecionáveis
  CORE.ExameCultura "0..*" -left- "0..1" CME.LoteEtiqueta : refere-se a
  CORE.InspecaoMaterial "0..*" -left- "1" CME.KitEsterilizavel : inspeciona
  CORE.Movimentacao "0..*" -left- "1" CME.LoteEtiqueta : movimenta
}

note bottom
Guideline:
- Tudo que for “estrutural/abstrato” fica em CORE (reuso hospitalar).
- Tudo que for “processo de esterilização” fica em CME.
- Interfaces do CORE (Rastreavel/Movimentavel/Inspecionavel) permitem componibilidade.
- IDs Long e vínculo explícito a Tenant/User mantêm aderência ao projeto atual.
end note
@enduml
